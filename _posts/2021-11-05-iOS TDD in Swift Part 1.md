---
title:  "iOS TDD in Swift Part 1" 
---

---

æˆ‘åœ¨å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°çš„ä¸¤ç§å¥‡æ€ªç°è±¡ï¼š

- ä¸ºäº†å°½å¿«ææµ‹ï¼Œç»å¸¸ææµ‹åæ‰å¼€å§‹å†™ Unit Test Case (åè¾¹ç®€ç§° UT)ï¼Œ QA å’Œ UT å‡ ä¹åŒæ—¶è¿›è¡Œã€‚å½“å†™ UT æ—¶å‘ç°ä»£ç è¢«ä¹±æ”¾ï¼Œéœ€è¦è°ƒæ•´ä½ç½®ï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·é€»è¾‘æ”¹åŠ¨ï¼Œå¯¼è‡´äº†éœ€è¦å›æµ‹ï¼Œæµªè´¹äº†å¼€å‘å’Œæµ‹è¯•æ›´å¤šçš„æ—¶é—´ã€‚
- å½“å†™å®Œéœ€æ±‚å†å»å†™ UTï¼Œå½“æ—¶æ˜¯é€šè¿‡çš„ï¼Œä½†éšç€éœ€æ±‚è¿­ä»£ï¼Œæœ‰äººåœ¨å‡½æ•°é‡ŒåŠ äº†ä¸å½±å“ UT çš„ä»£ç ï¼Œç”±äºä¸å¼ºåˆ¶åœ¨å†™ä»£ç å‰å†™å¥½ Test Caseï¼Œåˆ™å¯èƒ½ä¼šå‡ºç° UT æ£€æµ‹çš„å’Œå‡½æ•°æ‰§è¡Œä¸ä¸€è‡´ã€‚æ—¶é—´ä¹…äº†å°±ä¼šå‡ºç° UT æ— æ³•ä½¿ç”¨çš„æƒ…å†µã€‚

Test-driven development(åè¾¹ç®€ç§° TDD) æ­£å¥½èƒ½è§£å†³ä¸Šè¾¹ä¸¤ä¸ªç°è±¡ï¼Œèƒ½è®©æˆ‘å†™å‡º testable å’Œ reasonable çš„ codeï¼Œè¿™å°±å¤Ÿäº†ã€‚

## Section I: Hello, TDD

### 1. Introduction To TDD

#### 1.1 What is TDD

TDD æ˜¯ä¸€ç§é€šè¿‡è¿­ä»£åœ°è¿›è¡Œè®¸å¤šç”±æ”¯æŒæµ‹è¯•çš„å°å˜æ›´æ¥å¼€å‘è½¯ä»¶çš„è¿­ä»£æ–¹å¼ã€‚è¿™ä¸ªæ˜¯ TDD å¾ªç¯ï¼ˆåè¾¹ä¼šè¯¦ç»†ä»‹ç»ï¼Œå…ˆæœ‰ä¸ªå°è±¡ï¼‰

<img src="https://assets.alexandria.raywenderlich.com/books/itdd/images/1fd7eb6808587a2d64b149794f3228d347d9d62c10d15dba04ce068afce474aa/original.png" alt="img" style="zoom: 25%;" />

TDD å¾ªç¯åˆ†ä¸ºå››æ­¥:

1. å†™ä¸€ä¸ªä¼šå¤±è´¥çš„ testã€‚
2. è®©è¿™ä¸ª test é€šè¿‡ã€‚
3. é‡æ„ã€‚
4. é‡å¤æ‰§è¡Œæ‰€æœ‰ testsã€‚

TDD èƒ½ç¡®ä¿å½»åº•å¹¶ç²¾ç¡®åœ°æµ‹è¯•ä½ çš„ä»£ç ï¼Œå› ä¸ºä½ çš„ä»£ç æ˜¯è¢« Test é©±åŠ¨çš„ã€‚è¡¨é¢ä¸Šçœ‹ï¼ŒTDD ä¼¼ä¹éå¸¸ç®€å•ï¼Œå®é™…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

#### 1.2 Why should you use TDD

TDD æ˜¯ç¡®ä¿ä½ çš„ä»£ç èƒ½æ‰§è¡ŒæˆåŠŸå’Œå°†æ¥èƒ½æ‰§è¡ŒæˆåŠŸæœ€å¥½çš„æ–¹å¼ã€‚

å…³äºæµ‹è¯•ä»£ç ï¼Œå¹¶éå¿…é¡»ä½¿ç”¨ TDDï¼Œä½ å½“ç„¶å¯ä»¥å®Œæˆä¸šåŠ¡å¼€å‘åå†å†™ UTï¼Œæˆ–è€…ä½ å¯ä»¥ç›´æ¥æ‰‹åŠ¨æµ‹è¯•ä½ çš„ä»£ç ï¼ˆæƒ³èµ·ä¹‹å‰åœ¨çš„ä¸€ä¸ªå›¢é˜Ÿæ¯ä¸¤å‘¨éƒ½è¦å‘ç‰ˆä¸€æ¬¡ï¼Œç„¶åè®©å¼€å‘ä»¬æ‰‹åŠ¨æ‰§è¡Œä¸€é case ğŸ¶ï¼‰ã€‚ä¸ºä»€ä¹ˆ TDD æ¯”å…¶ä»–çš„æ–¹å¼å¥½ï¼Ÿ

å¥½çš„ test èƒ½ä¿è¯ä½ çš„ App æŒ‰ç…§æœŸæœ›è¿è¡Œï¼Œç„¶è€Œï¼Œä¸æ˜¯æ‰€æœ‰çš„ Test éƒ½æ˜¯"å¥½çš„"ã€‚å¥½çš„ test åº”è¯¥æ˜¯å¯å¤±è´¥çš„ã€å¯é‡å¤çš„ã€å¿«é€Ÿè¿è¡Œçš„å’Œå¯ç»´æŠ¤çš„ã€‚

TDD æä¾›äº†æ–¹æ³•æ¥ç¡®ä¿ä½ çš„ test æ˜¯å¥½çš„ï¼š

- ç¬¬ä¸€æ­¥å°±æ˜¯å†™ä¸€ä¸ªä¼šå¤±è´¥çš„ testï¼Œä¸å¤±è´¥çš„ Test åªæ˜¯åœ¨æµªè´¹ CPUã€‚
- å½“ä½ æƒ³å†™æ–°çš„ testï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰ä¹‹å‰çš„ tests éƒ½é€šè¿‡ï¼Œè¿™å°±ç¡®ä¿ä½ çš„ tests æ˜¯å¯é‡å¤çš„ã€‚ä½ ä¸èƒ½åªæ‰§è¡Œä½ æ­£åœ¨å¼€å‘çš„ testï¼Œå»ºè®®æ‰§è¡Œå…¨éƒ¨ testsã€‚
- ç”±äºè¦ç»å¸¸æ‰§è¡Œæ‰€æœ‰çš„ testsï¼Œæ‰€ä»¥è¦ç¡®ä¿ test æ˜¯å¿«é€Ÿæ‰§è¡Œçš„ï¼Œå¦‚æœå¤ªä¹…ï¼Œæ²¡äººä¼šæ‰§è¡Œæ‰€æœ‰çš„ testsã€‚
- å½“ä½ åœ¨é‡æ„æ—¶ï¼Œä½ éœ€è¦åŒæ—¶æ›´æ–°äº†ç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä»£ç ï¼Œä½ éœ€è¦ä¸æ–­åœ°ä¿æŒå®ƒä»¬åˆ°æœ€æ–°ã€‚
- é€šè¿‡åŒæ—¶è¿­ä»£æ›´æ–°ç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä»£ç ï¼Œä½ ç¡®ä¿äº†ä»£ç æ˜¯å¯æµ‹è¯•çš„ï¼Œå¦‚æœä½ æ˜¯å®Œæˆå¼€å‘åæ‰å†™ testï¼Œä¼¼ä¹ä¼šå› ä¸ºå®Œæˆ UT éœ€è¦ä¸€äº›ä»£ç é‡æ„ã€‚

å°½ç®¡å¦‚æ­¤ï¼Œä½ å¯èƒ½è®¤ä¸ºå³ä¾¿ä¸ä½¿ç”¨ TDDï¼Œä½ ä¹Ÿèƒ½å†™å‡ºå¥½çš„ testã€‚ä½ å½“ç„¶å¯ä»¥ï¼ŒçŸ­æœŸå¾ˆå®¹æ˜“åšåˆ°ï¼Œä½†æ˜¯é•¿æœŸä¸‹æ¥ä¼šå¾ˆéš¾ã€‚ä¸ä¹…ï¼Œä½ ä¼šåˆ›é€ ä¸€äº›æ–¹æ³•æ¥ç¡®ä¿ä½ åœ¨å†™å¥½çš„ testï¼Œä½ ä¼šå‘ç°ä½ å°±åœ¨åš TDDï¼

#### 1.3 What should you test

æ›´é«˜çš„æµ‹è¯•è¦†ç›–ç‡ä¸ä»£è¡¨ä½ çš„ App æ­£åœ¨è¢«æ›´å¥½çš„æµ‹è¯•ï¼Œä¸‹è¾¹æ˜¯ä¸€äº›å»ºè®®ï¼š

- å»ºè®®ä¸ºè‡ªåŠ¨åŒ–ä¸èƒ½æ•è·çš„ä»£ç å†™ testï¼Œæ¯”å¦‚ä½ è‡ªå®šä¹‰ç±»é‡Œçš„å‡½æ•°ã€è‡ªå®šä¹‰äº† getters å’Œ setters å’Œå¤§å¤šæ•°ä½ è‡ªå·±å†™çš„ä»£ç ï¼Œä¸å»ºè®®ä¸ºç”Ÿæˆå‡ºçš„ä»£ç å†™ testï¼Œæ¯”å¦‚ç”Ÿæˆå‡º getters å’Œ settersï¼ŒSwift å·²ç»åšçš„å¾ˆå¥½ï¼Œä½ å¯ä»¥ç›¸ä¿¡å®ƒèƒ½æ­£å¸¸ workã€‚
- ä¸å»ºè®®ä¸ºç¼–è¯‘å™¨èƒ½æ•è·çš„é—®é¢˜æ¥å†™ testã€‚
- ä¸å»ºè®®ä¸ºåŸºç¡€åº“æˆ–ç¬¬ä¸‰æ–¹åº“å†™ testï¼Œè¿™äº›åº“çš„ä½œè€…åº”è¯¥å†™ testï¼Œä¸¾ä¸ªğŸŒ°ï¼Œä½ ä¸åº”è¯¥ä¸º UIKit çš„ç±»æ¥å†™ testsï¼Œç„¶è€Œä½ éœ€è¦ä¸ºä½ æ‰€ç»§æ‰¿çš„å­ç±»å†™ testsã€‚è¿™äº›æ˜¯ä½ è‡ªå®šä¹‰å‡ºæ¥çš„ä»£ç ï¼Œæ‰€ä»¥ä½ åº”è¯¥å†™å¯¹åº”çš„ testsã€‚

æœ‰ä¸¤ä¸ªä¾‹å¤–ï¼Œä¸€ç§æƒ…å†µæ˜¯ä½ æƒ³çŸ¥é“ä¸€ä¸ª framework æ˜¯å¦‚ä½• workï¼Œé‚£ä¹ˆå†™ä¸€äº› test æ˜¯æœ‰å¸®åŠ©çš„ï¼Œä½†æ˜¯è¿™äº› testsä¸ä¼šæŒç»­å¾ˆä¹…ã€‚å¦ä¸€ç§æ˜¯ç¬¬ä¸‰æ–¹çš„ä»£ç éå¸¸ä¸ç¨³å®šï¼Œæ‰€ä»¥éœ€è¦å†™ tests æ¥ç¡®ä¿ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘è¦ä¸è¦ä½¿ç”¨è¿™ä¸ªåº“äº†ã€‚

#### TDD èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼

æœ€å¸¸è§çš„æŠ±æ€¨äº†ã€‚

å…¶å®ï¼Œå½“ä½ ä¹ æƒ¯ä½¿ç”¨ TDD æ¥å¼€å‘åä¼šæ¯”æ ¹æœ¬ä¸å†™ tests æ›´å¿«ï¼Œå› ä¸ºåè€…ä½ æœ€ç»ˆå†™äº†æ›´å¤šçš„ä»£ç ã€‚TDD ä¼šåœ¨å¼€å§‹æ¶ˆè€—ä¸€äº›æ—¶é—´ã€‚

å€¼å¾—è®¨è®ºçš„é—®é¢˜æ˜¯ï¼šå¼€å‘èŠ±è´¹çš„çœŸå®æ—¶é—´ï¼ä»–ä¸æ­¢æ˜¯å†™ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¹ŸåŒ…æ‹¬åè¾¹çš„æ–°éœ€æ±‚ï¼Œå˜æ›´ä»£ç ï¼Œä¿®å¤ bugs ç­‰ç­‰ï¼Œåœ¨è¿™ä¸ªé•¿è·‘è¿‡ç¨‹ä¸­ï¼Œç›¸æ¯”äºæ²¡æœ‰ TDD ï¼ŒTDD èŠ±è´¹äº†æ›´å°‘çš„æ—¶é—´ï¼Œå› ä¸ºå®ƒç”Ÿäº§æ›´ç›¸å…³çš„ä»£ç ï¼Œå¸¦æ¥æ›´å°‘çš„ bugsã€‚

å¦ä¸€ä¸ªéœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼šçº¿ä¸Š bug çš„å½±å“ã€‚å¦‚æœ bug æ˜¯å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ï¼Œä¼šéå¸¸å®¹æ˜“ä¿®å¤ï¼Œä½†æ˜¯å¦‚æœè¿‡äº†å‡ å‘¨æ‰å‘ç°ï¼Œä½ ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´ debg ä»£ç æ¥å¯»æ‰¾æ ¹æœ¬åŸå› ï¼Œä½ çš„ tests ä¼šå¸®åŠ©ä½ å¯¹æŠ—è¿™ç§æƒ…å†µã€‚

#### 1.4 When should you use TDD

å¦‚æœä½ çš„ Appå°†è¦æœ‰ release çš„ç‰ˆæœ¬ï¼ŒåŒæ—¶/æˆ–è€…ä½ çš„å·¥ç¨‹æœ‰å¤æ‚é€»è¾‘ï¼Œé‚£ä¹ˆä½ æœ€å¥½åŠæ—¶ä½¿ç”¨ TDDã€‚

å¦‚æœä½ åªæ˜¯ç”¨æ¥å†™ä¸€ä¸ª demo å·¥ç¨‹æˆ–è€…ä¸´æ—¶çš„å·¥ç¨‹ï¼Œ é‚£ä¹ˆä½ éšæ„ã€‚

æ€»ä¹‹ï¼ŒTDD æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œä½ è‡ªå·±æ¥å†³å®šä»€ä¹ˆæ—¶å€™æ¥ä½¿ç”¨å®ƒã€‚

#### 1.5 Key points

åœ¨è¿™ä¸ªå°èŠ‚ï¼Œä½ åº”è¯¥äº†è§£äº† TDD æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä½¿ç”¨å®ƒï¼Œå“ªäº›ä»£ç åº”è¯¥è¢«æµ‹è¯•å’Œä»€ä¹ˆæ—¶é—´å»ä½¿ç”¨å®ƒã€‚

- TDD æå¤Ÿäº†å†™å¥½çš„ tests çš„æ–¹å¼ã€‚
- å¥½çš„ test æ˜¯å¯å¤±è´¥çš„ã€å¯é‡å¤çš„ã€å¿«é€Ÿè¿è¡Œçš„å’Œå¯ç»´æŠ¤çš„ã€‚
- å¼€å‘çœŸæ­£çš„æ—¶é—´èŠ±è´¹åŒ…å«åˆå§‹å¼€å‘ï¼Œæ·»åŠ æ–°éœ€æ±‚ï¼Œä¿®æ”¹ç°æœ‰é€»è¾‘å’Œä¿®å¤ bugs ç­‰ç­‰ã€‚TDD å‡å°‘ç»´æŠ¤æˆæœ¬å’Œä¿è¯äº† bugs çš„å¯æ§
- TDD å¯¹äºä¸€ä¸ªé•¿æœŸçš„é¡¹ç›®æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚

### 2. Introduction To TDD Cycle

#### 2.1Getting Started

åœ¨è¿™ä¸ªå°èŠ‚ï¼Œä½ è®²ç»§ç»­å…³æ³¨äº TDD ä»£æ›¿ Xcode çš„è®¾ç½®ï¼Œä½ å¯ä»¥ä½¿ç”¨ playgroundï¼Œåˆ›å»ºä¸€ä¸ª **CashRegister.playground** ã€‚"File" -> "New" -> "Playground", é€‰æ‹© "Blank"ã€‚

![image-20211110182716628](https://github.com/zhaoxiangyulove/zhaoxiangyulove.github.io/blob/main/assets/pic/image-20211110182716628.png?raw=true)

åˆ æ‰æ‰€æœ‰çš„ä»£ç ã€‚

å¼€å§‹ä½¿ç”¨ TDDã€‚

#### 2.2 Red: Write a falling test

åœ¨ä½ å†™ä»»ä½•ç”Ÿäº§ä»£ç å‰ï¼Œä½ éœ€è¦å†™ä¸€ä¸ªä¼šå¤±è´¥çš„ testã€‚

é¦–å…ˆä½ éœ€è¦å»ºä¸€ä¸ª test çš„ç±»ï¼Œå¤åˆ¶ä¸‹è¾¹çš„ä»£ç åˆ° playgroundã€‚

```swift
import XCTest

class CashRegisterTests: XCTestCase {

}
```

ç¼–è¯‘ï¼Œå¦‚æœæŠ¥é”™ **error: unable to load standard library for target 'arm64-apple-macos11.0'** éœ€è¦å°† platform è®¾ç½®ä¸º macOSï¼Œè¿è¡Œé€šè¿‡ã€‚

æ¥ä¸‹æ¥åœ¨ playground æœ€ä¸‹æ–¹æ·»åŠ 

```swift
CashRegisterTests.defaultTestSuite.run()
```

è¿™æ˜¯å‘Šè¯‰ playground å»è·‘ <hl>CashRegisterTests</hl> ä¸‹æ‰€æœ‰çš„ testsï¼Œç„¶è€Œè¿˜æ²¡æœ‰ä»»ä½• testsï¼Œæ‰€ä»¥åœ¨é‡Œè¾¹æ·»åŠ ä¸€ä¸ªä¼šå¼•èµ·ç¼–è¯‘æŠ¥é”™çš„ testã€‚

![WX20211110-185352](https://github.com/zhaoxiangyulove/zhaoxiangyulove.github.io/blob/main/assets/pic/WX20211110-185352.png?raw=true)

1. è§£é‡Šä¸‹å‡½æ•°å‘½åï¼š

- XCTestï¼šéœ€è¦æ‰€æœ‰çš„æµ‹è¯•å‡½æ•°ä»¥ <hl>test</hl> å¼€å¤´ã€‚
- testï¼šæ¥ä¸‹æ¥æ˜¯å‡½æ•°è¦æµ‹è¯•çš„åå­—ï¼Œè¿™é‡Œæ˜¯ <hl>init</hl>ï¼Œç”¨ "_"å’Œä¸‹ä¸ªéƒ¨åˆ†åŒºåˆ†ã€‚
- æœ€åçš„éƒ¨åˆ†æ˜¯æœŸæœ›çš„è¾“å‡ºæˆ–ç»“æœï¼Œè¿™é‡Œæ˜¯ <hl>createsCashRegister</hl> ã€‚

è¿™ç§å‘½åå®¹æ˜“ç†è§£åŒæ—¶æä¾›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚æœ test å¤±è´¥äº†ï¼ŒXcode ä¼šå‘Šè¯‰ä½  test çš„ç±»å’Œå‡½æ•°åï¼Œé€šè¿‡è¿™ç§å‘½åæ–¹å¼å¯ä»¥å¿«é€Ÿäº†è§£é—®é¢˜ã€‚

2. ä½ è¯•å›¾åˆå§‹åŒ–ä¸€ä¸ª<hl>CashRegister</hl> çš„å®ä¾‹ã€‚é€šè¿‡ <hl>XCTAssertNotNil</hl> è¡¨è¾¾å¼æ¥åˆ¤æ–­ï¼Œå½“å‚æ•°ä¸ä¸º nil åˆ™é€šè¿‡ã€‚

ç„¶è€Œï¼Œç¬¬ä¸ƒè¡Œå¹¶ä¸èƒ½ç¼–è¯‘ï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰åˆ›å»º<hl>CashRegister</hl> çš„ç±»ï¼Œåœ¨ TDD é‡Œæœ‰è¿™æ ·ä¸€æ¡è§„åˆ™ï¼Œç¼–è¯‘å¤±è´¥è§†ä¸º test å¤±è´¥ï¼Œæ‰€ä»¥ä½ å·²ç»å®Œæˆäº† TDD å¾ªç¯çš„ç¬¬ä¸€æ­¥ Redï¼Œç°åœ¨è¿›è¡Œä¸‹ä¸€æ­¥ã€‚

#### 2.3 Green: Make the test pass

ä½ åªèƒ½å†™æœ€å°‘çš„ä»£ç è®©è¿™ä¸ª test é€šè¿‡ï¼Œå¦‚æœä½ å†™äº†æ¯”ä¸‹è¾¹çš„ä»£ç æ›´å¤šï¼Œä½ çš„ test å°†ä¼šè½åäºä½ çš„ç”Ÿäº§ä»£ç ï¼é‚£æœ€å°‘çš„ä»£ç èƒ½è§£å†³è¿™ä¸ªç¼–è¯‘é—®é¢˜çš„ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿå£°æ˜ä¸€ä¸ª<hl>CashRegister</hl>ç±»ï¼

åœ¨<hl>CashRegisterTest</hl>ä¸Šæ–¹æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š

```swift
class CashRegister {
  
}
```

ç‚¹å‡»æ‰§è¡Œï¼Œä½ ä¼šçœ‹åˆ°æ§åˆ¶å°è¾“å‡ºï¼š

```swift
Test Suite 'CashRegisterTests' started at 2021-11-10 22:20:45.074
Test Case '-[__lldb_expr_18.CashRegisterTests testInit_createsCashRegister]' started.
Test Case '-[__lldb_expr_18.CashRegisterTests testInit_createsCashRegister]' passed (0.003 seconds).
Test Suite 'CashRegisterTests' passed at 2021-11-10 22:20:45.078.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.003 (0.004) seconds
```

å¥½è€¶ï¼ä½ å·²ç»è®© test é€šè¿‡äº†ï¼Œä¸‹ä¸€æ­¥ï¼Œé‡æ„ä½ çš„ä»£ç ã€‚

#### 2.4 Refactor: Clean up your code

#### 2.5 Repeat: Do it again

#### 2.6 Challenge

#### 2.7 Key points









